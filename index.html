<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>@motioneffector/dialogue - Demo</title>
  <link rel="stylesheet" href="demo-files/demo.css">
</head>
<body>
  <div class="page">
    <header class="header">
      <h1 class="header-title">@motioneffector/dialogue</h1>
      <p class="header-description">A lightweight, type-safe branching dialogue system for games and interactive fiction.</p>
      <nav class="header-links">
        <a href="https://www.npmjs.com/package/@motioneffector/dialogue" class="header-link" target="_blank">üì¶ npm</a>
        <a href="https://github.com/motioneffector/dialogue" class="header-link" target="_blank">üíª GitHub</a>
        <a href="manual/index.html" class="header-link">Manual</a>
      </nav>
    </header>

    <main>
      <!-- Test Runner (FIRST) -->
      <section class="test-runner" id="test-runner">
        <div class="test-runner-header">
          <h2 class="test-runner-title">Test Runner</h2>
        </div>
        <div class="test-runner-content">
          <!-- Control bar: progress bar + buttons, above output console -->
          <div class="test-control-bar">
            <div class="test-progress">
              <div class="test-progress-bar">
                <div class="test-progress-fill" id="progress-fill"></div>
              </div>
              <div class="test-progress-text" id="progress-text">Ready</div>
            </div>
            <div class="test-runner-actions">
              <button class="btn btn-primary" id="run-all-tests">
                <span class="btn-icon">‚ñ∂</span>
                <span>Run All Tests</span>
              </button>
              <button class="btn btn-secondary" id="reset-page">
                <span class="btn-icon">‚Üª</span>
                <span>Reset Page</span>
              </button>
            </div>
          </div>
          <!-- Output console below the control bar -->
          <div class="test-output" id="test-output">
            <div class="test-output-placeholder">Click "Run All Tests" to execute the test suite and see a live demonstration</div>
          </div>
          <div class="test-summary hidden" id="test-summary"></div>
        </div>
      </section>

      <!-- Exhibit 1: The Conversation -->
      <section class="exhibit" id="exhibit-1">
        <div class="exhibit-header">
          <h2 class="exhibit-title">The Conversation</h2>
          <p class="exhibit-description">Core dialogue experience - branching paths, choices, speakers, actions executing visibly, text interpolation as a visible transformation.</p>
        </div>
        <div class="exhibit-content">
          <div class="exhibit-interactive">
            <div class="conversation-layout">
              <div class="speaker-column">
                <div class="speaker-portrait active" id="speaker-portrait">üè™</div>
                <div class="speaker-name" id="speaker-name">Merchant</div>
              </div>
              <div class="dialogue-column">
                <div class="dialogue-box">
                  <div class="dialogue-text" id="dialogue-text"></div>
                  <div class="choices-list hidden" id="choices-list"></div>
                  <div class="dialogue-ended hidden" id="dialogue-ended">
                    <p>Dialogue has ended.</p>
                    <button class="btn btn-primary" id="restart-btn">Restart</button>
                  </div>
                </div>
              </div>
            </div>
            <div class="action-stream">
              <div class="action-stream-title">Action Stream</div>
              <div id="action-stream-content"></div>
            </div>
            <div class="flags-panel">
              <div class="flag-group">
                <div class="flag-group-title">Game Flags</div>
                <div id="game-flags"></div>
              </div>
              <div class="flag-group">
                <div class="flag-group-title">Conversation Flags</div>
                <div id="conv-flags"></div>
              </div>
            </div>
          </div>
          <div class="exhibit-controls">
            <button class="btn btn-secondary" id="restart-dialogue-btn">Restart</button>
            <label class="toggle">
              <input type="checkbox" id="show-all-actions" checked>
              <span class="toggle-switch"></span>
              <span class="toggle-label">Show All Actions</span>
            </label>
          </div>
        </div>
      </section>

      <!-- Exhibit 2: The Condition Laboratory -->
      <section class="exhibit" id="exhibit-2">
        <div class="exhibit-header">
          <h2 class="exhibit-title">The Condition Laboratory</h2>
          <p class="exhibit-description">How conditions control choice visibility with a hands-on, circuit-board style interaction.</p>
        </div>
        <div class="exhibit-content">
          <div class="exhibit-interactive">
            <div class="lab-layout">
              <div class="lab-inputs">
                <div class="lab-inputs-title">Inputs (drag sliders, flip switches)</div>
                <div class="lab-input-row">
                  <span class="lab-input-name">gold</span>
                  <input type="range" class="lab-slider" id="lab-gold" min="0" max="250" value="120">
                  <span class="lab-input-value" id="lab-gold-value">120</span>
                </div>
                <div class="lab-input-row">
                  <span class="lab-input-name">hasKey</span>
                  <div class="lab-switch">
                    <div class="lab-switch-track" id="lab-hasKey">
                      <div class="lab-switch-thumb"></div>
                    </div>
                    <span class="lab-switch-label" id="lab-hasKey-label">OFF</span>
                  </div>
                </div>
                <div class="lab-input-row">
                  <span class="lab-input-name">reputation</span>
                  <input type="range" class="lab-slider" id="lab-reputation" min="-100" max="100" value="30">
                  <span class="lab-input-value" id="lab-reputation-value">30</span>
                </div>
                <div class="lab-input-row">
                  <span class="lab-input-name">class</span>
                  <select class="lab-select" id="lab-class">
                    <option value="warrior" selected>warrior</option>
                    <option value="mage">mage</option>
                    <option value="rogue">rogue</option>
                  </select>
                </div>
              </div>
              <div class="lab-gates">
                <div class="lab-gates-title">Logic Gates (watch signals flow through)</div>
                <div id="lab-conditions"></div>
              </div>
              <div class="lab-outputs">
                <div class="lab-outputs-title">Outputs (choices light up when available)</div>
                <div id="lab-outputs"></div>
              </div>
            </div>
          </div>
          <div class="exhibit-controls">
            <button class="btn btn-secondary" id="randomize-lab-btn">Randomize Inputs</button>
          </div>
        </div>
      </section>

      <!-- Exhibit 3: The Time Machine -->
      <section class="exhibit" id="exhibit-3">
        <div class="exhibit-header">
          <h2 class="exhibit-title">The Time Machine</h2>
          <p class="exhibit-description">History tracking, navigation, and state management - with VISUAL state, not JSON.</p>
        </div>
        <div class="exhibit-content">
          <div class="exhibit-interactive">
            <div class="time-machine-layout">
              <div class="current-moment">
                <div class="current-moment-text" id="tm-current-text">Loading...</div>
                <div class="current-moment-choices" id="tm-choices"></div>
              </div>
              <div class="timeline-section">
                <div class="timeline-title">Timeline (scrub through your history)</div>
                <div class="timeline-track" id="tm-timeline"></div>
                <div class="timeline-controls">
                  <button class="btn btn-secondary btn-small" id="tm-back-btn">‚óÄ Back</button>
                  <input type="range" class="timeline-slider" id="tm-slider" min="0" max="0" value="0">
                  <button class="btn btn-secondary btn-small" id="tm-forward-btn">Forward ‚ñ∂</button>
                </div>
              </div>
              <div class="state-at-moment">
                <div class="state-panel">
                  <div class="state-panel-title">Game Flags</div>
                  <div id="tm-game-flags"></div>
                </div>
                <div class="state-panel">
                  <div class="state-panel-title">Conv Flags</div>
                  <div id="tm-conv-flags"></div>
                </div>
                <div class="state-panel">
                  <div class="state-panel-title">What Changed Here</div>
                  <div id="tm-changes"></div>
                </div>
              </div>
              <div class="save-slots">
                <div class="save-slot filled" id="save-slot-0">
                  <div class="save-slot-title">Slot 1</div>
                  <div class="save-slot-preview">üè™</div>
                  <div class="save-slot-info">150g - Node 3</div>
                  <div class="save-slot-actions">
                    <button class="btn btn-small btn-primary">Load</button>
                  </div>
                </div>
                <div class="save-slot" id="save-slot-1">
                  <div class="save-slot-title">Slot 2</div>
                  <div class="save-slot-empty">Empty</div>
                </div>
                <div class="save-slot" id="save-slot-2">
                  <div class="save-slot-title">Slot 3</div>
                  <div class="save-slot-empty">Empty</div>
                </div>
                <div class="save-slot" id="save-slot-3">
                  <div class="save-slot-title">+ Save</div>
                  <div class="save-slot-empty">Save Here</div>
                </div>
              </div>
            </div>
          </div>
          <div class="exhibit-controls">
            <button class="btn btn-secondary" id="tm-restart-btn">Restart</button>
            <button class="btn btn-secondary" id="tm-auto-play-btn">‚ñ∂ Auto-Play</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Library (from dist) -->
  <script type="module">
    import * as Library from './dist/index.js'
    window.Library = Library
  </script>

  <!-- Demo scripts (order matters) -->
  <script src="demo-files/test-runner.js"></script>
  <script src="demo-files/demo.js"></script>
  <script src="demo-files/tests.js"></script>

  <!-- Event handlers for buttons (using addEventListener in demo.js would be better, but for simplicity) -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Exhibit 1
      const restartBtn = document.getElementById('restart-btn')
      const restartDialogueBtn = document.getElementById('restart-dialogue-btn')
      if (restartBtn) restartBtn.addEventListener('click', () => window.restartDialogue())
      if (restartDialogueBtn) restartDialogueBtn.addEventListener('click', () => window.restartDialogue())

      // Exhibit 2
      const randomizeLabBtn = document.getElementById('randomize-lab-btn')
      const labHasKeyTrack = document.getElementById('lab-hasKey')
      if (randomizeLabBtn) randomizeLabBtn.addEventListener('click', () => window.randomizeLabInputs())
      if (labHasKeyTrack) labHasKeyTrack.addEventListener('click', () => window.toggleLabSwitch('hasKey'))

      // Exhibit 3
      const tmBackBtn = document.getElementById('tm-back-btn')
      const tmForwardBtn = document.getElementById('tm-forward-btn')
      const tmRestartBtn = document.getElementById('tm-restart-btn')
      const tmAutoPlayBtn = document.getElementById('tm-auto-play-btn')
      if (tmBackBtn) tmBackBtn.addEventListener('click', () => window.tmBack())
      if (tmForwardBtn) tmForwardBtn.addEventListener('click', () => window.tmForward())
      if (tmRestartBtn) tmRestartBtn.addEventListener('click', () => window.tmRestart())
      if (tmAutoPlayBtn) tmAutoPlayBtn.addEventListener('click', () => window.tmAutoPlay())

      // Save slots
      const saveSlot3 = document.getElementById('save-slot-3')
      if (saveSlot3) saveSlot3.addEventListener('click', () => window.saveCurrentSlot())
    })
  </script>
</body>
</html>
